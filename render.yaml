services:
  - type: web
    name: glchemtec-openwebui
    env: docker
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: standard
    region: oregon
    healthCheckPath: /
    autoDeploy: true
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      # Route OpenAI calls through local proxy on port 8000
      - key: OPENAI_API_BASE_URLS
        value: "http://localhost:8000/v1"
      - key: MICROSOFT_CLIENT_ID
        sync: false
      - key: MICROSOFT_CLIENT_SECRET
        sync: false
      - key: MICROSOFT_TENANT_ID
        sync: false
      - key: WEBUI_NAME
        value: GLChemTec OpenWebUI
      - key: WEBUI_AUTH
        value: "true"
      - key: ENABLE_OAUTH_SIGNUP
        value: "true"
      - key: ENABLE_LOGIN_FORM
        value: "true"
      - key: ENABLE_PASSWORD_AUTH
        value: "true"
      - key: WEBUI_URL
        fromService:
          type: web
          name: glchemtec-openwebui
          property: host
      - key: MICROSOFT_REDIRECT_URI
        fromService:
          type: web
          name: glchemtec-openwebui
          property: host
          suffix: /oauth/microsoft/callback
      - key: WEBUI_SECRET_KEY
        sync: false
      - key: OPENID_PROVIDER_URL
        sync: false
      - key: CORS_ALLOW_ORIGIN
        value: ""
      - key: ENABLE_OAUTH_PERSISTENT_CONFIG
        value: "true"
      - key: MICROSOFT_OAUTH_SCOPE
        value: "openid email profile"
      - key: WEBUI_ADMIN_EMAIL
        value: "haron@glchemtec.ca"
      - key: WEBUI_ADMIN_PASSWORD
        sync: false
      # Document/File Processing Settings
      - key: RAG_EMBEDDING_MODEL
        value: "text-embedding-3-small"
      - key: ENABLE_RAG_WEB_SEARCH
        value: "false"
      - key: PDF_EXTRACT_IMAGES
        value: "true"
      - key: RAG_FILE_MAX_SIZE
        value: "100"
      - key: RAG_FILE_MAX_COUNT
        value: "10"
      - key: USER_PERMISSIONS_CHAT_FILE_UPLOAD
        value: "true"
      - key: DEFAULT_USER_ROLE
        value: "user"
      # Proxy settings
      - key: PROXY_DEBUG
        value: "true"
      # SharePoint integration
      - key: ENABLE_SHAREPOINT
        value: "true"
      - key: SHAREPOINT_CLIENT_ID
        sync: false
      - key: SHAREPOINT_CLIENT_SECRET
        sync: false
      - key: SHAREPOINT_TENANT_ID
        sync: false
      - key: SHAREPOINT_SITE_URL
        sync: false
      - key: SHAREPOINT_FOLDER
        value: "Documents"
      # Claude/Anthropic API for document analysis
      - key: ANTHROPIC_API_KEY
        sync: false
